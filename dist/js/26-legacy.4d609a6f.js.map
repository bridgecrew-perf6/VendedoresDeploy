{"version":3,"file":"js/26-legacy.4d609a6f.js","mappings":"mPAIO,SAAeA,EAAtB,kC,uDAAO,WAAkCC,GAAlC,8FACGC,GAAOC,EAAAA,EAAAA,IAAIC,EAAAA,GAAI,SAAU,GAAKC,EAAAA,EAAAA,MAAAA,OAAAA,YAAAA,IADjC,UAEGC,EAAAA,EAAAA,IAAUJ,EAAM,CAClBK,SAAUN,IAHX,2C,wBAOA,SAAeO,EAAtB,oC,uDAAO,WAA8BC,EAAgBC,GAA9C,oGACHC,QAAQC,IAAI,CAAEH,eAAAA,EAAgBC,KAAAA,IACxBG,EAAWR,EAAAA,EAAAA,MAAAA,OAAAA,YAAAA,GACXH,GAAOC,EAAAA,EAAAA,IAAIC,EAAAA,GAAI,SAAU,GAAKC,EAAAA,EAAAA,MAAAA,OAAAA,YAAAA,UAChCS,EAAcT,EAAAA,EAAAA,MAAAA,OAAAA,YAGbS,EAAYL,GAAgBM,WAC7BD,EAAYL,GAAgBM,SAAW,IAEtCD,EAAYL,GAAgBO,YAC7BF,EAAYL,GAAgBO,UAAY,KAExCF,EAAYL,GAAgBO,UAAUN,EAAKO,UAb5C,sBAcO,IAAIC,MAAM,kBAdjB,cAgBCC,EAAc,EACdC,EAAUN,EAAYL,GAAgBM,SAASF,GAC/CO,WACON,EAAYL,GAAgBO,UAAUI,EAAQH,UACrDE,EAAc,GAGlBL,EAAYL,GAAgBM,SAASF,GAAYH,EACjDI,EAAYL,GAAgBO,UAAUN,EAAKO,UAAYP,EAEvDC,QAAQC,IAAI,CAAEE,YAAAA,IAEVO,EAAWhB,EAAAA,EAAAA,MAAAA,OAAAA,oBACVgB,EAASC,UAASD,EAASC,QAAU,IACtCD,EAASC,QAAQjB,EAAAA,EAAAA,MAAAA,OAAAA,YAAAA,IAGjBgB,EAASC,QAAQjB,EAAAA,EAAAA,MAAAA,OAAAA,YAAAA,IAAmCkB,WAAaJ,EAFjEE,EAASC,QAAQjB,EAAAA,EAAAA,MAAAA,OAAAA,YAAAA,IAAqC,CAACkB,UAAUJ,EAAYK,MAAM,GA/BpF,WAoCGlB,EAAAA,EAAAA,IAAUJ,GAAD,QAAC,UACTmB,GADQ,IAEXI,KAAMX,KAtCP,4C,0FCXP,IAAIY,EAAS,WAAa,IAAIC,EAAIC,KAASC,EAAGF,EAAIG,eAAmBC,EAAGJ,EAAIK,MAAMD,IAAIF,EAAG,OAAOE,EAAG,cAAc,CAACE,MAAM,CAAC,MAAO,EAAM,OAAQ,IAAO,CAACF,EAAG,eAAe,CAACG,YAAY,cAAcC,YAAY,CAAC,OAAS,WAAWF,MAAM,CAAC,MAAQ,+BAA+B,QAAUN,EAAIS,QAAQ,MAAQT,EAAIU,aAAa,QAAUV,EAAIW,QAAQ,eAAe,GAAG,MAAQ,GAAG,gBAAgB,IAAIC,GAAG,CAAC,YAAYZ,EAAIa,SAAS,CAACT,EAAG,WAAW,CAACU,KAAK,OAAO,CAACV,EAAG,kBAAkB,CAACI,YAAY,CAAC,QAAU,OAAO,aAAa,WAAW,CAACR,EAAIe,GAAG,qCAAqC,IAAI,IAAI,IAC/jBC,EAAkB,G,6HC4BtB,GACAC,KADA,WAEA,OACAN,SAAAA,EACAO,MAAAA,GACAC,qBAAAA,KACAV,QAAAA,CACA,CAAAW,KAAAA,YAAAC,MAAAA,QACA,CAAAD,KAAAA,kBAAAC,MAAAA,UAAAC,MAAAA,SACA,CAAAF,KAAAA,gBAAAC,MAAAA,cAAAC,MAAAA,SACA,CAAAF,KAAAA,cAAAC,MAAAA,cAAAC,MAAAA,YAIAC,QAdA,WAcA,WACA,+DACA,aACAC,EAAAA,aAAAA,KAAAA,SAAAA,GACA,2CAAAlD,KAAAA,EAAAA,IAAAA,KACA,mBACAU,QAAAA,IAAAA,QAAAA,GACA,iBAEA,qBACAA,QAAAA,IAAAA,WAAAA,GAEA,oBACAA,QAAAA,IAAAA,UAAAA,EAAAA,IAAAA,eAKAyC,cAhCA,WAiCA,+CACA,6BAEAC,SAAAA,CACAhB,aADA,WAEA,kBACAiB,QAAA,4DACAC,KAAA,YACA,6DACA,yBACAC,GADA,IAEAlC,QAAAA,EAAAA,SAAAA,OAAAA,QAAAA,EAAAA,SAAAA,OACAmC,YAAAA,SAKAC,SAAAA,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAAA,IACAC,EAAAA,EAAAA,IAAAA,SAAAA,CAAAA,uBADA,IAEAnB,OAFA,SAEAoB,GAAA,iKAEA5D,EAAAA,EAAAA,IAAAA,EAAAA,MAFA,OAGA,qBAAAO,SAAAA,EAAAA,OACA,IACA,4CACA,yBACA,8CACAqD,EAAAA,KADA,gBAGAC,OAAAA,SAAAA,QAAAA,WACA,SACA,0BAZA,iDCjF8R,I,2DCO1RC,GAAY,OACd,EACApC,EACAiB,GACA,EACA,KACA,KACA,MAIF,EAAemB,EAAiB,QAOhC,IAAkBA,EAAW,CAACC,WAAU,eAAW,kBAAc","sources":["webpack://vendedores/./src/modules/seller/services/firebaseServices.js","webpack://vendedores/./src/modules/seller/views/SellerSelectRace.vue?6aaa","webpack://vendedores/src/modules/seller/views/SellerSelectRace.vue","webpack://vendedores/./src/modules/seller/views/SellerSelectRace.vue?72f9","webpack://vendedores/./src/modules/seller/views/SellerSelectRace.vue"],"sourcesContent":["import db from '@/common/services/firebaseUserService';\r\nimport { doc, updateDoc } from 'firebase/firestore';\r\nimport store from '@/store';\r\n\r\nexport async function setCurrentRaceUser(name) {\r\n    const user = doc(db, '/users', '' + store.state.common.currentUser.id);\r\n    await updateDoc(user, {\r\n        raceUser: name\r\n    });\r\n}\r\n\r\nexport async function closeSelection(selectionIndex, pict) {\r\n    console.log({ selectionIndex, pict });\r\n    const sellerId = store.state.common.currentUser.id;\r\n    const user = doc(db, '/users', '' + store.state.common.currentUser.raceUser);\r\n    let newRaceInfo = store.state.seller.currentRace;\r\n\r\n\r\n    if (!newRaceInfo[selectionIndex].pictures) {\r\n        newRaceInfo[selectionIndex].pictures = {};\r\n    }\r\n    if (!newRaceInfo[selectionIndex].pictLinks) {\r\n        newRaceInfo[selectionIndex].pictLinks = {};\r\n    }\r\n    if (newRaceInfo[selectionIndex].pictLinks[pict.original]) {\r\n        throw new Error('Alreaady taken');\r\n    }\r\n    let proposedInc = 1;\r\n    let oldPict = newRaceInfo[selectionIndex].pictures[sellerId];\r\n    if (oldPict) {\r\n        delete newRaceInfo[selectionIndex].pictLinks[oldPict.original];\r\n        proposedInc = 0;\r\n    }\r\n\r\n    newRaceInfo[selectionIndex].pictures[sellerId] = pict;\r\n    newRaceInfo[selectionIndex].pictLinks[pict.original] = pict;\r\n\r\n    console.log({ newRaceInfo });\r\n\r\n    let userInfo = store.state.seller.currentRaceUserInfo;\r\n    if (!userInfo.sellers) userInfo.sellers = {};\r\n    if(!userInfo.sellers[store.state.common.currentUser.id]){\r\n        userInfo.sellers[store.state.common.currentUser.id] = {proposals:proposedInc,score:0};\r\n    }else{\r\n        userInfo.sellers[store.state.common.currentUser.id].proposals += proposedInc;\r\n    }\r\n\r\n    await updateDoc(user, {\r\n        ...userInfo,\r\n        race: newRaceInfo\r\n    });\r\n}\r\n\r\n\r\n\r\nexport default db;","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('v-container',{attrs:{\"dark\":false,\"value\":true}},[_c('v-data-table',{staticClass:\"elevation-1\",staticStyle:{\"cursor\":\"pointer\"},attrs:{\"title\":\"Select a race to engage with\",\"headers\":_vm.headers,\"items\":_vm.users2render,\"loading\":_vm.loading,\"fixed-header\":\"\",\"dense\":\"\",\"single-select\":\"\"},on:{\"click:row\":_vm.engage}},[_c('template',{slot:\"top\"},[_c('v-toolbar-title',{staticStyle:{\"padding\":\"20px\",\"text-align\":\"center\"}},[_vm._v(\" Select a race to engage with \")])],1)],2)],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\r\n\t<v-container :dark=\"false\" :value=\"true\">\r\n\t\t<v-data-table\r\n\t\t\ttitle=\"Select a race to engage with\"\r\n\t\t\t:headers=\"headers\"\r\n\t\t\t:items=\"users2render\"\r\n\t\t\tclass=\"elevation-1\"\r\n\t\t\t:loading=\"loading\"\r\n\t\t\tfixed-header\r\n\t\t\tdense\r\n\t\t\tsingle-select\r\n\t\t\t@click:row=\"engage\"\r\n\t\t\tstyle=\"cursor: pointer\"\r\n\t\t>\r\n\t\t\t<template slot=\"top\">\r\n\t\t\t\t<v-toolbar-title style=\"padding: 20px; text-align: center\">\r\n\t\t\t\t\tSelect a race to engage with\r\n\t\t\t\t</v-toolbar-title>\r\n\t\t\t</template>\r\n\t\t</v-data-table>\r\n\t</v-container>\r\n</template>\r\n\r\n<script>\r\nimport db from \"@/common/services/firebaseUserService\";\r\nimport { collection, onSnapshot } from \"firebase/firestore\";\r\nimport { setCurrentRaceUser } from \"../services/firebaseServices\";\r\nimport { mapActions } from \"vuex\";\r\n\r\nexport default {\r\n\tdata() {\r\n\t\treturn {\r\n\t\t\tloading: true,\r\n\t\t\tusers: [],\r\n\t\t\tsnapshootUnsubscribe: null,\r\n\t\t\theaders: [\r\n\t\t\t\t{ text: \"User name\", value: \"name\" },\r\n\t\t\t\t{ text: \"Sellers engaged\", value: \"sellers\",align:\"start\" },\r\n\t\t\t\t{ text: \"Ongoing quiz \", value: \"ongoingQuiz\",align:\"start\" },\r\n\t\t\t\t{ text: \"Total quiz \", value: \"race.length\",align:\"start\" },\r\n\t\t\t],\r\n\t\t};\r\n\t},\r\n\tcreated() {\r\n\t\tthis.snapshootRef = onSnapshot(collection(db, \"users\"), (sn) => {\r\n\t\t\tthis.loading = false;\r\n\t\t\tsn.docChanges().map((change) => {\r\n\t\t\t\tlet d = { ...change.doc.data(), name: change.doc.id };\r\n\t\t\t\tif (change.type === \"added\") {\r\n\t\t\t\t\tconsole.log(\"added\", d);\r\n\t\t\t\t\tthis.users.push(d);\r\n\t\t\t\t}\r\n\t\t\t\tif (change.type === \"modified\") {\r\n\t\t\t\t\tconsole.log(\"modified\", d);\r\n\t\t\t\t}\r\n\t\t\t\tif (change.type === \"deleted\") {\r\n\t\t\t\t\tconsole.log(\"deleted\", change.doc.data());\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t});\r\n\t},\r\n\tbeforeDestroy() {\r\n\t\tif (typeof this.snapshootUnsubscribe === \"function\")\r\n\t\t\tthis.snapshootUnsubscribe();\r\n\t},\r\n\tcomputed: {\r\n\t\tusers2render() {\r\n\t\t\treturn this.users\r\n\t\t\t\t.filter((u) => u.type === \"user\" && Array.isArray(u.race))\r\n\t\t\t\t.map((u) => {\r\n\t\t\t\t\tlet ongoingQuiz = u.race.filter((r) => !r.selected).length;\r\n\t\t\t\t\treturn {\r\n\t\t\t\t\t\t...u,\r\n\t\t\t\t\t\tsellers: u.sellers && Object.entries(u.sellers).length,\r\n\t\t\t\t\t\tongoingQuiz,\r\n\t\t\t\t\t};\r\n\t\t\t\t});\r\n\t\t},\r\n\t},\r\n\tmethods: {\r\n\t\t...mapActions(\"common\", [\"updateCurrentUser\"]),\r\n\t\tasync engage(item) {\r\n\t\t\t// alert(item.name);\r\n\t\t\tawait setCurrentRaceUser(item.name);\r\n\t\t\tthis.updateCurrentUser({ raceUser: item.name });\r\n\t\t\ttry {\r\n\t\t\t\tif (typeof this.snapshootUnsubscribe === \"function\")\r\n\t\t\t\t\tthis.snapshootUnsubscribe();\r\n\t\t\t\tthis.$toast.success(\r\n\t\t\t\t\t`You are engaged to ${item.name}'s race now`\r\n\t\t\t\t);\r\n\t\t\t\twindow.location.replace('/seller');\r\n\t\t\t} catch (e) {\r\n\t\t\t\tthis.$toast.error(e.message);\r\n\t\t\t}\r\n\t\t},\r\n\t},\r\n};\r\n</script>\r\n\r\n<style></style>\r\n","import mod from \"-!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js??clonedRuleSet-40[0].rules[0].use[1]!../../../../node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./SellerSelectRace.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js??clonedRuleSet-40[0].rules[0].use[1]!../../../../node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./SellerSelectRace.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./SellerSelectRace.vue?vue&type=template&id=384189e8&\"\nimport script from \"./SellerSelectRace.vue?vue&type=script&lang=js&\"\nexport * from \"./SellerSelectRace.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../node_modules/@vue/vue-loader-v15/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports\n\n/* vuetify-loader */\nimport installComponents from \"!../../../../node_modules/vuetify-loader/lib/runtime/installComponents.js\"\nimport { VContainer } from 'vuetify/lib/components/VGrid';\nimport { VDataTable } from 'vuetify/lib/components/VDataTable';\nimport { VToolbarTitle } from 'vuetify/lib/components/VToolbar';\ninstallComponents(component, {VContainer,VDataTable,VToolbarTitle})\n"],"names":["setCurrentRaceUser","name","user","doc","db","store","updateDoc","raceUser","closeSelection","selectionIndex","pict","console","log","sellerId","newRaceInfo","pictures","pictLinks","original","Error","proposedInc","oldPict","userInfo","sellers","proposals","score","race","render","_vm","this","_h","$createElement","_c","_self","attrs","staticClass","staticStyle","headers","users2render","loading","on","engage","slot","_v","staticRenderFns","data","users","snapshootUnsubscribe","text","value","align","created","sn","beforeDestroy","computed","filter","map","u","ongoingQuiz","methods","mapActions","item","window","component","VContainer"],"sourceRoot":""}