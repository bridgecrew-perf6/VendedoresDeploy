"use strict";(self["webpackChunkvendedores"]=self["webpackChunkvendedores"]||[]).push([[833],{6640:function(e,t,s){s.d(t,{yo:function(){return o},if:function(){return l}});s(1703);var r=s(1618),n=s(5321),a=s(7376);async function o(e){console.log("current race user mutation");const t=(0,n.JU)(r.ZP,"/users",""+a.Z.state.common.currentUser.id);await(0,n.r7)(t,{raceUser:e});const s=(0,n.JU)(r.ZP,"/users",""+e);let o=(await(0,n.QT)(s)).data();o.sellers||(o.sellers={}),o.sellers[a.Z.state.common.currentUser.id]||(o.sellers[a.Z.state.common.currentUser.id]={score:0,proposals:0}),console.log(e," user info will be updated"),console.log({userInfo:o}),await(0,n.r7)(s,{raceUser:e,sellers:o.sellers})}async function l(e,t){console.log({selectionIndex:e,pict:t});const s=a.Z.state.common.currentUser.id,o=(0,n.JU)(r.ZP,"/users",""+a.Z.state.common.currentUser.raceUser);let l=a.Z.state.seller.currentRace;if(l[e].pictures||(l[e].pictures={}),l[e].pictLinks||(l[e].pictLinks={}),l[e].pictLinks[t.original])throw new Error("Alreaady taken");let i=1,c=l[e].pictures[s];c&&(delete l[e].pictLinks[c.original],i=0),l[e].pictures[s]=t,l[e].pictLinks[t.original]=t,console.log({newRaceInfo:l});let u=a.Z.state.seller.currentRaceUserInfo;u.sellers||(u.sellers={}),u.sellers[a.Z.state.common.currentUser.id]?u.sellers[a.Z.state.common.currentUser.id].proposals+=i:u.sellers[a.Z.state.common.currentUser.id]={proposals:i,score:0},await(0,n.r7)(o,{...u,race:l})}},3445:function(e,t,s){s.r(t),s.d(t,{default:function(){return b}});var r=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("v-container",{attrs:{dark:!1,value:!0}},[s("v-data-table",{staticClass:"elevation-1",staticStyle:{cursor:"pointer"},attrs:{title:"Select a race to engage with",headers:e.headers,items:e.users2render,loading:e.loading,"fixed-header":"",dense:"","single-select":"","no-data-text":"No user is hosting a race right now"},on:{"click:row":e.engage}},[s("template",{slot:"top"},[s("v-toolbar-title",{staticStyle:{padding:"20px","text-align":"center"}},[e._v(" Select a race to engage with ")])],1)],2)],1)},n=[],a=s(1618),o=s(5321),l=s(6640),i=s(629),c={data(){return{loading:!0,users:[],snapshootUnsubscribe:null,headers:[{text:"User name",value:"name"},{text:"Sellers engaged",value:"sellers",align:"start"},{text:"Ongoing quiz ",value:"ongoingQuiz",align:"start"},{text:"Total quiz ",value:"race.length",align:"start"}]}},created(){this.snapshootRef=(0,o.cf)((0,o.hJ)(a.ZP,"users"),(e=>{this.loading=!1,e.docChanges().map((e=>{let t={...e.doc.data(),name:e.doc.id};"added"===e.type&&(console.log("added",t),this.users.push(t)),"modified"===e.type&&console.log("modified",t),"deleted"===e.type&&console.log("deleted",e.doc.data())}))}))},beforeDestroy(){"function"===typeof this.snapshootUnsubscribe&&this.snapshootUnsubscribe()},computed:{users2render(){return this.users.filter((e=>"user"===e.type&&Array.isArray(e.race)&&!e.raceDone)).map((e=>{let t=e.race.filter((e=>!e.selected)).length;return{...e,sellers:e.sellers&&Object.entries(e.sellers).length,ongoingQuiz:t}}))}},methods:{...(0,i.nv)("common",["updateCurrentUser"]),async engage(e){try{await(0,l.yo)(e.name),this.updateCurrentUser({raceUser:e.name}),"function"===typeof this.snapshootUnsubscribe&&this.snapshootUnsubscribe(),this.$toast.success(`You are engaged to ${e.name}'s race now`),this.$router.push("/seller")}catch(t){this.$toast.error(t.message)}}}},u=c,d=s(1001),g=s(3453),p=s.n(g),h=s(9846),m=s(6310),f=s(7921),U=(0,d.Z)(u,r,n,!1,null,null,null),b=U.exports;p()(U,{VContainer:h.Z,VDataTable:m.Z,VToolbarTitle:f.qW})}}]);
//# sourceMappingURL=833.0346dee7.js.map