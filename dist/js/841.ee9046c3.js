"use strict";(self["webpackChunkvendedores"]=self["webpackChunkvendedores"]||[]).push([[841],{3237:function(t,e,r){r.d(e,{Z:function(){return o}});var n=r(5648),s=r(4981),a=r(6505),i=r(3325),o=(0,i.Z)(s.Z,a.Z,n.Z).extend({name:"v-card",props:{flat:Boolean,hover:Boolean,img:String,link:Boolean,loaderHeight:{type:[Number,String],default:4},raised:Boolean},computed:{classes(){return{"v-card":!0,...a.Z.options.computed.classes.call(this),"v-card--flat":this.flat,"v-card--hover":this.hover,"v-card--link":this.isClickable,"v-card--loading":this.loading,"v-card--disabled":this.disabled,"v-card--raised":this.raised,...n.Z.options.computed.classes.call(this)}},styles(){const t={...n.Z.options.computed.styles.call(this)};return this.img&&(t.background=`url("${this.img}") center center / cover no-repeat`),t}},methods:{genProgress(){const t=s.Z.options.methods.genProgress.call(this);return t?this.$createElement("div",{staticClass:"v-card__progress",key:"progress"},[t]):null}},render(t){const{tag:e,data:r}=this.generateRouteLink();return r.style=this.styles,this.isClickable&&(r.attrs=r.attrs||{},r.attrs.tabindex=0),t(e,this.setBackgroundColor(this.color,r),[this.genProgress(),this.$slots.default])}})},7118:function(t,e,r){r.d(e,{h7:function(){return a},ZB:function(){return o},EB:function(){return c}});var n=r(3237),s=r(4589);const a=(0,s.Ji)("v-card__actions"),i=(0,s.Ji)("v-card__subtitle"),o=(0,s.Ji)("v-card__text"),c=(0,s.Ji)("v-card__title");n.Z},634:function(t,e,r){r.d(e,{Z:function(){return c},w:function(){return o}});var n=r(9669),s=r.n(n),a=r(1485);function i(t=Date.now()){var e=new Date(t),r=""+(e.getMonth()+1),n=""+e.getDate(),s=e.getFullYear();return r.length<2&&(r="0"+r),n.length<2&&(n="0"+n),[s,r,n].join("-")}async function o(){return(await s().get(a.bo+"/sellers")).data}async function c(t,e){console.log({quantity:t,seller:e});let r=Date.now();return(await s().post(a.bo+"/invoices",{date:i(r),dueDate:i(r+6912e5),client:1,items:[{id:1,price:1,quantity:t}],seller:e,status:"open"})).data}},4691:function(t,e,r){r.d(e,{Z:function(){return p}});var n=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("v-row",{attrs:{justify:"center"}},[r("v-dialog",{attrs:{persistent:"","max-width":"290"},model:{value:t.value,callback:function(e){t.value=e},expression:"value"}},[r("v-card",[r("v-card-title",{staticClass:"text-h5"},[t._v(" "+t._s(t.title||"Confirm?")+" ")]),t.text?r("v-card-text",[t._v(t._s(t.text))]):t._e(),r("v-card-actions",[r("v-spacer"),r("v-btn",{attrs:{color:"secondary darken-1",text:""},on:{click:t.cancel}},[t._v(" "+t._s(t.cancelText||"cancel")+" ")]),r("v-btn",{attrs:{color:"primary darken-1",text:""},on:{click:t.accept}},[t._v(" "+t._s(t.okText||"ok")+" ")])],1)],1)],1)],1)},s=[],a={props:{title:String,text:String,okText:String,cancelText:String,value:Boolean},methods:{accept(){this.$emit("input",!1),this.$emit("accept",!0)},cancel(){this.$emit("input",!1)}}},i=a,o=r(1001),c=r(3453),l=r.n(c),u=r(3150),d=r(3237),h=r(7118),v=r(6662),g=r(2877),f=r(9762),m=(0,o.Z)(i,n,s,!1,null,null,null),p=m.exports;l()(m,{VBtn:u.Z,VCard:d.Z,VCardActions:h.h7,VCardText:h.ZB,VCardTitle:h.EB,VDialog:v.Z,VRow:g.Z,VSpacer:f.Z})},4841:function(t,e,r){r.r(e),r.d(e,{default:function(){return x}});var n=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("v-container",[r("v-row",{attrs:{"align-content":"center",justify:"center"}},[r("v-col",{staticClass:"text-subtitle-1 text-center",attrs:{cols:"12"}},[r("v-alert",{attrs:{type:"user"===t.currentUser.type?"info":t.winner?"success":"error",text:""}},[r("h2",{staticClass:"main-header",style:t.titleStyle},[t._v(t._s(t.title))]),r("div",{staticStyle:{"font-size":"small"}},[t._v(" Race finished at "+t._s(t.finishDate)+" ")])])],1)],1),r("v-row",{staticClass:"my-5",attrs:{"align-content":"center",justify:"center"}},[r("scores",{staticStyle:{"min-width":"98%","max-width":"700px"},attrs:{sellers:t.raceDone.sellers,myId:t.currentUser.id}})],1),"seller"===t.currentUser.type?r("v-row",{staticClass:"my-1",attrs:{"align-content":"center",justify:"center"}},[t.winner?r("div",{staticClass:"text-subtitle-1 text-center py-2",attrs:{cols:"12"}},[r("article",[t._v(" As the winer of the race you may now generate an "),r("a",{attrs:{href:"alegra.com"}},[t._v("Alegra")]),t._v(" invoice. Once it's done you can delete all your records of the race and start from scratch with another race if you want to ")])]):r("div",{staticClass:"text-subtitle-1 text-center py-2",attrs:{cols:"12"}},[r("article",[t._v(" You can delete all your records of the race and start from scratch with another race if you want to ")])])]):t._e(),t.winner?r("v-row",{staticClass:"my-2",attrs:{"align-content":"center",justify:"center",cols:"12"},on:{click:t.generateInvoice}},[r("v-btn",{attrs:{width:"200",disabled:t.raceDone.invoice}},[t.loadingInvoice?r("v-progress-circular",{attrs:{indeterminate:"",color:"primary",width:"2"}}):r("div",[t._v("generateInvoice")])],1)],1):t._e(),"seller"===t.currentUser.type?r("v-row",{staticClass:"my-2",attrs:{"align-content":"center",justify:"center"}},[r("v-btn",{attrs:{width:"200",disabled:t.winner&&!t.raceDone.invoice},on:{click:function(e){t.confirmDialog=!0}}},[t.loadingFromScratch?r("v-progress-circular",{attrs:{indeterminate:"",color:"primary",width:"2"}}):r("div",[t._v("Start from scratch")])],1)],1):t._e(),r("confirm-dialog",{attrs:{text:"You won't be able to see the information related to this race anymore"},on:{accept:t.resetSeller},model:{value:t.confirmDialog,callback:function(e){t.confirmDialog=e},expression:"confirmDialog"}}),t._v(" > ")],1)},s=[],a=(r(1703),r(629)),i=r(9381),o=r(1618),c=r(634),l=r(4691),u={components:{Scores:i.Z,ConfirmDialog:l.Z},data(){return{loadingInvoice:!1,loadingFromScratch:!1,confirmDialog:!1}},computed:{...(0,a.rn)("common",["currentUser"]),raceDone(){return this.currentUser.raceDone},winner(){return this.raceDone.winner===this.currentUser.id},title(){return this.winner?"Congrats, you Won":`Race has finished, ${this.raceDone.winner} won`},finishDate(){return new Date(this.raceDone.timestamp).toLocaleString()},titleStyle(){return"user"===this.currentUser.type?"color:blue":this.winner?"color:green":"color:red"}},methods:{...(0,a.nv)("common",["updateCurrentUser"]),...(0,a.nv)(["resetState"]),async resetSeller(){if("seller"===this.currentUser.type){this.loadingFromScratch=!0;try{let t=this.currentUser;t.raceUser=null,t.raceDone=null,console.log({user:t},{id:this.currentUser.id}),await(0,o.Nq)(this.currentUser.id,t),this.$router.push({path:"/"}),this.updateCurrentUser(t),this.resetState(),this.$toast.success("Done!, you can start from scratch now")}catch(t){this.$toast.error(t.message)}finally{this.loadingFromScratch=!1}}},async generateInvoice(){this.loadingInvoice=!0;let t=0;for(const r in this.raceDone.sellers)if(Object.hasOwnProperty.call(this.raceDone.sellers,r)){const e=this.raceDone.sellers[r];t+=e.score}try{if(!this.currentUser.alegraInfo)throw new Error("Account not linked to alegra");let e=await(0,c.Z)(t,this.currentUser.alegraInfo),r=this.raceDone;r.invoice=e,this.updateCurrentUser({raceDone:r}),await(0,o.Nq)(this.currentUser.raceUser,{raceDone:r}),setTimeout((()=>(0,o.Nq)(this.currentUser.id,{raceDone:r}))),this.$toast.success("Invoice created")}catch(e){this.$toast.error(e.message)}finally{this.loadingInvoice=!1}}}},d=u,h=r(1001),v=r(3453),g=r.n(v),f=r(5098),m=r(3150),p=r(2102),y=r(9846),w=r(624),_=r(2877),D=(0,h.Z)(d,n,s,!1,null,null,null),x=D.exports;g()(D,{VAlert:f.Z,VBtn:m.Z,VCol:p.Z,VContainer:y.Z,VProgressCircular:w.Z,VRow:_.Z})}}]);
//# sourceMappingURL=841.ee9046c3.js.map